- #2311 #HY_V4R4C010H01B03 #svn26906 git4036c70
- 用nfc stress test來測有patch & 無patch的差異
	- 無patch
		- !!!NfcStress_TestCase1...
		  Last Loop:201, Meta Error Count=0.
		  Total Write AU:7372800, Total Read AU:4843304 take 16787ms, Erase take **2000ms**.
		  Write: 1756 MB/s, Read: 1154 MB/s, Total: 2910 MB/s.
		  Pure - Write: 1994 MB/s, Read: 1310 MB/s, Total: 3304 KB/s.
		  core temp:53 flash temp:48
		- !!!NfcStress_TestCase2...
		  Last Loop:101, Meta Error Count=0.
		  Total Write AU:3686400, Total Read AU:2602372 take 11279ms, Erase take **1000ms**.
		  Write: 1307 MB/s, Read: 922 MB/s, Total: 2229 MB/s.
		  Pure - Write: 1434 MB/s, Read: 1012 MB/s, Total: 2446 KB/s.
		  core temp:54 flash temp:48
	- 有patch，erase不管是跑multi sync或async的數據都差不多，以下是multi sync的數據
		- !!!NfcStress_TestCase1...
		  Last Loop:201, Meta Error Count=0.
		  Total Write AU:7372800, Total Read AU:4843048 take 22666ms, Erase take **7804ms**.
		  Write: 1301 MB/s, Read: 854 MB/s, Total: 2155 MB/s.
		  Pure - Write: 1984 MB/s, Read: 1303 MB/s, Total: 3287 KB/s.
		  core temp:45 flash temp:43
		- !!!NfcStress_TestCase2...
		  Last Loop:101, Meta Error Count=0.
		  Total Write AU:3686400, Total Read AU:2601307 take 13987ms, Erase take **3900ms**.
		  Write: 1054 MB/s, Read: 743 MB/s, Total: 1797 MB/s.
		  Pure - Write: 1461 MB/s, Read: 1031 MB/s, Total: 2492 KB/s.
		  core temp:45 flash temp:44
	- 可以看到，erase的部份，有加patch花費的時間是沒有patch的三倍多
- 單測一次multi sync
	- 有加patch，erase_time = 55ms
	- 沒加patch，erase_time = 25ms
- 因為patch是sync操作，若放在async和multi sync的流程裡，會讓它們的強制都變成sync，就會花更多時間
- 會影響multi sync的原因：
	- multi sync是以pb為單位做sync，而每個pb內的每個die之間是async操作
	- 而我的patch加入時機，是在一個die的erase放進wait response queue後就加入patch
	- 因為patch是sync操作，所以這樣會變成一個die的erase+patch都做完，才會開始下一個die的erase
	- 這樣速度就跟一般的sync沒兩樣了
	- 所以patch的加入時機，應該要加在所有die都丟進wait response queue之後再加
- **解決方式：將patch改為async，這樣性能就會和沒有patch差不多了**